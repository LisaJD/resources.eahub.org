{{ define "main" }}
  <article class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray">
    {{ .Content }}
  </article>
  {{/* Define a section to pull recent posts from. For Hugo 0.20 this will default to the section with the most number of pages. */}}
  {{ $mainSections := .Site.Params.mainSections | default (slice "post") }}
  {{/* Create a variable with that section to use in multiple places. */}}
  {{ $section := where .Site.RegularPages "Section" "in" $mainSections }}
  {{/* Check to see if the section is defined for ranging through it */}}
  {{ $section_count := len $section }}
  {{ if ge $section_count 1 }}
    {{/* Derive the section name  */}}
    {{ $section_name := index (.Site.Params.mainSections) 0 }}

    <!-- Carousel -->
    <section class="flex-ns flex-wrap justify-around mt5">
      {{ range .Sections }}
      {{ if eq .Params.menu_item "true" }}
        <a class="carousel_links" href="{{ .URL }}">
          <img src={{ .Params.link_image }} />
          <div class="carousel_links_text">{{ .Title }}</div>
        </a>
      {{ end }}
      {{ end }}
    </section>

    <!-- Selection of popular articles -->

    <div class="pa2 pa4-ns w-100 w-70-ns center">
      <h1 class="flex-none">Selection of Popular Articles</h1>
      {{ range .Pages }}
        {{ if eq .Params.Tag "popular" }}
        <h1 class="f3 fw1 athelas mt0 lh-title">
          <a href="{{.URL}}" class="color-inherit dim link"> {{ .Title }}</a>
        </h1>
        <div class="f6 f5-l lh-copy nested-copy-line-height nested-links">
          {{ .Summary }}
        </div>
        <p class="f6 lh-copy mv0">By {{ .Params.Author }}</p>
        {{ end }}
      {{ end }}
    </div>


  {{ end }}
{{ end }}
